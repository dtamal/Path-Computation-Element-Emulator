tNetwork={};tNetwork.NetworkNode=function(){};tNetwork.NetworkLayer=function(){};tNetwork.NetworkBus=function(){};tNetwork.NetworkBusLink=function(){};tNetwork.NetworkLink=function(){};(function(e){"use strict";var t=tNetwork.NetworkLink,n=tNetwork.NetworkNode,r=tNetwork.NetworkBus,i=tNetwork.NetworkLayer,s=tNetwork.NetworkBusLink;tNetwork.Network=function(){this.currentX=0;this.currentY=0;this.currentMatrix=0;this.selectedElement=0;this.editingNetwork=0;this.mouseDown=0;this.eventProcessed=0;this.zoom=1;var o=this;this.selectedLinkList=[];this.selectedBusList=[];this.selectedBusLinkList=[];this.nodeList=[];this.linkList=[];this.layerList=[];this.busList=[];this.busLinkList=[];this.version="1.09.01-dev";this.getVersion=function(){return this.version};this.addDefs=function(e){this.defs_id=e};this.setProperties=function(t,n){if(n!==e){t.properties=n}};this.addSVG=function(e){this.svg_id=e};this.addNode=function(t,r,i,s,o,u,a){var f=new n;this.nodeList[t]=f;f.show=true;f.elementType="node";f.x=r;f.y=i;f.id=t;f.labels={};f.numLabels=0;f.labelOffset=13;if(u===""){u={p1:a,p2:t}}if(a!==e&&a!==""){this.addLabel("node",t,a)}if(o!==e&&o!==""&&o.height==e&&o.width==e){f.style=o}else{f.style=$.extend(true,{},tNetwork.styles.node.defaultNode)}if(s!==e&&s!==""){var l=new Image;if(o==e||o.height==e&&o.width==e){$(l).on("load",function(){f.style.params.width=l.width;f.style.params.height=l.height})}else{f.style.params.width=o.width;f.style.params.height=o.height}l.src=s;f.style.params.href=s;f.style.type="image"}this.setProperties(f,u);this.addHighlight(t)};this.addLayer=function(t,n,r,s,o){var u=new i;u.show=true;u.elementType="layer";u.y1=r;u.y2=r+n;if(s==e||s=="")s="#CCCCCC";u.style={id:t,type:"rect",params:{"class":"defaultLayer",transform:"matrix(1 0 0 1 0 0)",style:"fill:"+s,width:"6000",height:n,x:"-3000",y:r}};this.layerList[t]=u;this.setProperties(u,o)};this.addVerticalBus=function(t,n,i,s,o,u){var a=new r;a.show=true;a.elementType="bus";a.id=t;a.x=n;a.dy=0;a.dx=0;a.labels={};a.numLabels=0;a.labelOffset=13;if(s!==e&&tNetwork.styles.bus[s]!==e){a.style=$.extend(true,{},tNetwork.styles.bus[s])}else if(tNetwork.styles.bus[t]===e){a.style=$.extend(true,{},tNetwork.styles.bus.defaultBus)}else{a.style=$.extend(true,{},tNetwork.styles.bus[t])}if(s!==e){if(s.color!==e)a.style.params.stroke=s.color;if(s.width!==e)a.style.params["stroke-width"]=s.width}a.style["id"]=t;if(i!==e&&i!=="")a.style["min_height"]=i;else a.style["min_height"]=0;this.busList[t]=a;this.setProperties(a,o);if(u!==e&&u!==""){this.addLabel("bus",a.id,u)}};this.addBusLink=function(t,n,r,i){var o=new s;o.show=true;o.elementType="buslink";o.id=t+":"+n;o.labels={};o.numLabels=0;o.labelOffset=13;o.bus=this.busList[t];o.node=this.nodeList[n];if(o.bus===e||o.node===e){console.log(o.bus);console.log(o.node);console.log(o.id+" Not created, missing some element")}else{o.style=o.bus.style;this.busLinkList[t+":"+n]=o;this.setProperties(o,r)}if(i!==e&&i!==""){this.addLabel("link",o.id,i)}};this.addLink=function(n,r,i,s,o,u){var a=new t;a.show=true;a.elementType="link";a.id=n+":"+r;a.labels={};a.numLabels=0;a.labelOffset=13;a.src=this.nodeList[n];a.dst=this.nodeList[r];if(a.src===e||a.dst===e){console.log("WARNING !! FIXME!! MULTIDOMAIN LINK, NOT IMPLEMENTED YET");console.log("source: "+n+" dest: "+r);return}this.linkList[a.id]=a;a.bidirectional=i;if(a.bidirectional===true){a.style=$.extend(true,{},tNetwork.styles.link.defaultBidirectionalLink);if(s!==e&&s!==""&&s.color==e&&s.stroke==e){a.style=s}}else{a.style=$.extend(true,{},tNetwork.styles.link.defaultUnidirectionalLink);a.style.arrow=tNetwork.styles.arrow.triangleArrow;if(s!==e&&s!==""&&s.color==e&&s.stroke==e){a.style=s;a.style.arrow=tNetwork.styles.arrow.triangleArrow}}if(s!==e&&s!==""){if(s.color!==e){a.style.params["class"]="default";a.style.params.stroke=s.color}if(s.width!==e){a.style.params["stroke-width"]=s.width}}if(u!==e&&u!==""){this.addLabel("link",a.id,u)}this.setProperties(a,o)};this.clearLabels=function(t,n){var r=o.elements[t]["list"][n];if(r!==e){r.labels={};r.numLabels=0}};this.getLabelText=function(t,n,r){var i=o.elements[t]["list"][n];if(i!==e&&i.numLabels>r){return i.labels[r].label}else return""};this.addLabel=function(t,n,r,i,s,u){var a,f,l;var c;var h,p;var d=false;if(d!==e&&d!==""){if(u==="true"||u===true){d=true}}c=o.elements[t]["setlabel"];if(c!==e){h=o.elements[t]["labelposx"];p=o.elements[t]["labelposy"];l=o.elements[t]["list"];if(l!==e&&l[n]!==e){a=l[n];f=a.numLabels;a.labels[f]={};a.labels[f].label=r;a.labels[f].show=d;if(s==="top"||s==="bottom"||s==="center")a.labels[f].posY=s;else a.labels[f].posY=p;if(i==="right"||i==="left"||i==="center")a.labels[f].posX=i;else a.labels[f].posX=h;a.numLabels++}}else{console.log("label not supported yet for "+t)}};this.addHighlight=function(t,r){var i=this.elements["node"]["list"][t];var s=new n;s.show=false;if(i!==e){if(r===e){if(i.style.type==="circle"){s.style=$.extend(true,{},tNetwork.styles.node.defaultHighlightCircle)}else{s.style=$.extend(true,{},tNetwork.styles.node.defaultHighlight)}}else{s.style=$.extend(true,{},r)}i.highlight=s;i.highlight.show=false}};this.toggleHighlightLine=function(t,n,r){var i=this.elements["link"]["list"];var s=this.elements["buslink"]["list"];var o=new Array(i,s);var u=t+":"+n;var a=n+":"+t;var f="";var l="";var c;var h;var p=false;for(f in o){for(l in o[f]){if(u===l||a===l){c=o[f][l].svg;if(r!==e){p=r==="true"||r==true}else p=c!==e&&c.getAttributeNS(null,"class")!=="selectedLink";if(p){h=c.getAttributeNS(null,"stroke-width");c.setAttributeNS(null,"class","selectedLink");c.setAttributeNS(null,"stroke-width",h*1+1)}else{c.setAttributeNS(null,"class",o[f][l].style.params.class);c.setAttributeNS(null,"stroke-width",o[f][l].style.params["stroke-width"]);if(o[f][l].style.params.stroke!==e)c.setAttributeNS(null,"stroke",o[f][l].style.params.stroke)}}}}};this.toggleHighlightBus=function(t,n){var r=this.elements["bus"]["list"][t];var i,s;if(r!==e){i=r.svg;if(n&&i.getAttributeNS(null,"class")!=="selectedLink"){s=i.getAttributeNS(null,"stroke-width");i.setAttributeNS(null,"class","selectedLink");i.setAttributeNS(null,"stroke-width",s*1+1)}}};this.checkNetworkStatus=function(){if(o.svg_id==null){console.log("no hay svg, creando uno..");o.svg_id="tNetworkSVG";var e='<svg id="'+o.svg_id+'" xmlns="http://www.w3.org/2000/svg"';e+=' xmlns:xlink="http://www.w3.org/1999/xlink" height="100%" width="100%">';$("body").append(e)}if(this.defs_id==null){console.log("no hay defs, creando uno..");this.defs_id="tNetworkDefs";var e='<defs id="'+this.defs_id+'"></defs>';$("body").append(e)}};this.drawNetwork=function(){var t;var n;var r;var i;this.checkNetworkStatus();$("#"+o.svg_id+" g").remove();this.net=document.createElementNS(this.svgNS,"g");if(this.globalTransformMatrix!==e){this.net.setAttributeNS(null,"transform",this.globalTransformMatrix)}document.getElementById(o.svg_id).appendChild(this.net);for(t in tNetwork.styles.arrow){this.addArrowToDefs(tNetwork.styles.arrow[t],t)}for(r in this.elements){n=this.getList(r);for(i in n){if(n.hasOwnProperty(i)&&n[i].show===true){this.draw(n[i])}}}};this.draw=function(t){var n=this.elements[this.getType(t)]["draw"];var r,i;if(n!==e){n.call(this,t);this.drawProperties(t);r=this.elements[this.getType(t)]["setlabel"];if(r!==e){var s,o,u;var a=this.labelCounter();for(i in t.labels){this.drawLabel(t,i,a);this.drawProperties(t.labels[i])}}}};this.drawLayer=function(e){var t;t=document.createElementNS(this.svgNS,e.style.type);tNetwork.setSVGAttributes(t,e.style.params);t.setAttributeNS(null,"id",e.style.id);e.svg=t;this.net.appendChild(t)};this.drawBus=function(e){var t;var n=[];t=document.createElementNS(this.svgNS,e.style.type);t.setAttributeNS(null,"id",e.style.id);e.svg=t;e.dy=0;e.dx=0;n[e.style.id]=e;tNetwork.setSVGAttributes(e.svg,e.style.params);e.svg.setAttributeNS(null,"x1",e.x);e.svg.setAttributeNS(null,"x2",e.x);this.setBusPosition(e);this.net.appendChild(t)};this.drawNode=function(e){var t,n;t=document.createElementNS(this.svgNS,e.style.type);tNetwork.setSVGAttributes(t,e.style.params);t.setAttributeNS(null,"id",e.id);e.svg=t;this.drawHighlight(e);if(e.style.type==="circle"){t.setAttributeNS(null,"cx",e.x);t.setAttributeNS(null,"cy",e.y)}else if(e.style.type==="image"){t.setAttributeNS(null,"x",e.x-e.style.params.width/2);t.setAttributeNS(null,"y",e.y-e.style.params.height/2);t.setAttributeNS(this.xlinkNS,"href",e.style.params.href)}else{throw"type not supported, ask for it to ogondio"}this.net.appendChild(t);for(n in this.defaultNodeHandlers){t.addEventListener(n,this.defaultNodeHandlers[n],false)}};this.drawHighlight=function(t){if(t.highlight!==e&&t.highlight.show){var n;n=document.createElementNS(this.svgNS,t.highlight.style.type);t.highlight.svg=n;tNetwork.setSVGAttributes(n,t.highlight.style.params);this.net.appendChild(n);if(t.highlight.style.type==="circle"){n.setAttributeNS(null,"cx",t.x);n.setAttributeNS(null,"cy",t.y)}else if(t.highlight.style.type==="rect"){n.setAttributeNS(null,"x",t.x-t.style.params.width/2);n.setAttributeNS(null,"y",t.y-t.style.params.height/2)}this.setHighlightPos(t)}};this.hideHighlight=function(){var t="",n;n=this.elements["node"]["list"];for(t in n){if(n[t].highlight!==e)n[t].highlight.show=false}};this.drawLink=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;t=document.createElementNS(this.svgNS,"line");e.svg=t;tNetwork.setSVGAttributes(t,e.style.params);o=e.bidirectional;g={};y={};tNetwork.crossingOutPoint(e.src.style,e.src.x,e.src.y,e.dst.x,e.dst.y,e.style.offset,g);tNetwork.crossingOutPoint(e.dst.style,e.dst.x,e.dst.y,e.src.x,e.src.y,-1*e.style.offset,y);t.setAttributeNS(null,"x1",e.src.x+g.x);t.setAttributeNS(null,"y1",e.src.y+g.y);t.setAttributeNS(null,"x2",e.dst.x+y.x);t.setAttributeNS(null,"y2",e.dst.y+y.y);t.setAttributeNS(null,"id",e.src.id+":"+e.dst.id);this.net.appendChild(t);for(m in this.defaultLinkHandlers){t.addEventListener(m,this.defaultLinkHandlers[m],false)}};this.drawBusLink=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;var b,w,E,S;t=document.createElementNS(this.svgNS,"line");e.svg=t;g={};tNetwork.crossingOutPoint(e.node.style,e.node.x,e.node.y,e.bus.x,e.node.y,0,g);tNetwork.setSVGAttributes(t,e.bus.style.params);t.setAttributeNS(null,"x1",e.node.x+g.x);t.setAttributeNS(null,"y1",e.node.y+g.y);t.setAttributeNS(null,"x2",e.bus.x);t.setAttributeNS(null,"y2",e.node.y+g.y);t.setAttributeNS(null,"id",e.id);this.net.appendChild(t);for(m in this.defaultLinkHandlers){t.addEventListener(m,this.defaultLinkHandlers[m],false)}};this.drawLabel=function(e,t,n){var r,i,s,o;r=document.createElementNS(this.svgNS,"text");this.net.appendChild(r);r.setAttributeNS(null,"class","defaultLabel");i=document.createTextNode(e.labels[t].label);r.appendChild(i);e.labels[t].svg=r;s=tNetwork.styles.labelRect;o=document.createElementNS(this.svgNS,s.type);tNetwork.setSVGAttributes(o,s.params);e.labels[t].labelRect=o;this.net.appendChild(o);this.net.appendChild(r);this.setLabelPos(e,e.labels[t],n)};this.drawProperties=function(t){var n,r,i,s,o;if(t.properties!==e){r=t.svg;n=document.createElementNS(this.svgNS,"title");i=t.properties;o="";for(s in i){o+=i[s]+"\n"}$(n).text(o);r.appendChild(n)}};this.hideElement=function(e,t,n){this.changeElementVisibility(false,e,t,n)};this.showElement=function(e,t,n){this.changeElementVisibility(true,e,t,n)};this.startEditMode=function(){var e,t,n;o.selectedElement=0;if(o.editMode){return}o.editMode=true;o.editingNetwork=this;for(e in o.nodeList){if(o.nodeList[e].show===true){o.setElementProperty(o.nodeList[e],"cursor","move");o.addEventHandlerElement(o.nodeList[e],"mousedown",o.selectElement)}}for(t in o.busList){if(o.busList[t].show===true){o.setElementProperty(o.busList[t],"cursor","move");o.addEventHandlerElement(o.busList[t],"mousedown",o.selectElement)}}n=document.getElementById(o.svg_id);n.addEventListener("mouseup",o.selectSVGUp,false);n.addEventListener("mousedown",o.selectSVGDown,false);n.addEventListener("mousemove",o.selectSVGMove,false);n.addEventListener("mouseout",o.selectSVGOut,false);if(navigator.userAgent.indexOf("Chrome")!==-1||navigator.userAgent.indexOf("Safari")!==-1||navigator.userAgent.indexOf("Opera")!==-1||navigator.userAgent.indexOf("IE9")!==-1){n.addEventListener("mousewheel",o.scrolling,false)}else if(navigator.userAgent.indexOf("Firefox")){n.addEventListener("DOMMouseScroll",o.scrolling,false)}else{alert("This browser doesn't support scrolling")}o.setDefaultNodeEventHandler("mousedown",o.selectElement);o.boxX=document.getElementById(o.svg_id).getBBox().x;o.boxY=document.getElementById(o.svg_id).getBBox().y;o.mouseDown=0};this.stopEditMode=function(){var e,t;o.selectedElement=0;e=document.getElementById(o.svg_id);e.removeEventListener("mouseup",o.selectSVGUp,false);e.removeEventListener("mousedown",o.selectSVGDown,false);e.removeEventListener("mousemove",o.selectSVGMove,false);e.removeEventListener("mouseout",o.selectSVGOut,false);if(navigator.userAgent.indexOf("Chrome")!==-1||navigator.userAgent.indexOf("Safari")!==-1||navigator.userAgent.indexOf("Opera")!==-1||navigator.userAgent.indexOf("IE9")!==-1){e.removeEventListener("mousewheel",o.scrolling,false)}else if(navigator.userAgent.indexOf("Firefox")){e.removeEventListener("DOMMouseScroll",o.scrolling,false)}else{}for(t in o.nodeList){o.setElementProperty(o.nodeList[t],"cursor","move");o.removeEventHandlerNode(o.nodeList[t],"mousedown",o.selectElement)}this.editMode=false;for(t in this.nodeList){this.setElementProperty(this.nodeList[t],"cursor","move")}};this.highlightAll=function(t){var n;if(t!==e)n=t;for(var r in o.elements["node"]["list"]){o.toggleHighlight("node",o.elements["node"]["list"][r].id,n);if(n===e)n=o.elements["node"]["list"][r].highlight.show}o.globalTransformMatrix=$("#mySVG g").attr("transform");o.drawNetwork();for(var r in o.elements["link"]["list"]){o.toggleHighlight("link",o.elements["link"]["list"][r].id,n)}for(var r in o.elements["buslink"]["list"]){o.toggleHighlight("buslink",o.elements["buslink"]["list"][r].id,n)}for(var r in o.elements["bus"]["list"]){o.toggleHighlight("bus",o.elements["bus"]["list"][r].id,n)}};this.labelCounter=function(){var e;e={};e["bottom:center"]=0;e["bottom:left"]=0;e["bottom:right"]=0;e["top:center"]=0;e["top:left"]=0;e["top:right"]=0;e["center:center"]=0;e["center:left"]=0;e["center:right"]=0;return e};this.setLabelsPos=function(e){var t,n;n=this.labelCounter();for(t in e.labels){this.setLabelPos(e,e.labels[t],n)}};this.setLabelPos=function(t,n,r){var i;i=this.elements[t.elementType]["setlabel"];if(i!==e){i.call(this,t,n,r)}};this.setLabelPosNode=function(e,t,n){var r,i,s;var o,u,a;var f,l,c;var h=0,p;var d,v;c=e.svg;f=t.svg;l=t.labelRect;u=t.posY;o=t.posX;a=u+":"+o;s=f.getComputedTextLength();if(e.style.type==="circle"){d=c.getAttributeNS(null,"r")*2;v=d}else{d=c.getAttributeNS(null,"height");v=c.getAttributeNS(null,"width")}if(u==="bottom"){h=d/2+12+e.labelOffset*n[a]}else if(u==="top"){h=-d/2-5-e.labelOffset*n[a]}else{h=0}if(o==="right"){p=v/2+5}else if(o==="left"){p=-v/2-5-s}else{p=-s/2}f.setAttributeNS(null,"x",e.x+p);f.setAttributeNS(null,"y",e.y+h);r=f.getAttributeNS(null,"x");i=f.getAttributeNS(null,"y");l.setAttributeNS(null,"x",r-2);l.setAttributeNS(null,"y",i-10);l.setAttributeNS(null,"width",s+4);n[a]++};this.setLabelPosLink=function(t,n,r){var i,s,o;var u,a,f;var l,c,h;var p=0,d=0;var v=0,m=0,g=0,y=0,b,w;var E;h=t.svg;l=n.svg;c=n.labelRect;v=h.getAttributeNS(null,"x1");m=h.getAttributeNS(null,"x2");g=h.getAttributeNS(null,"y1");y=h.getAttributeNS(null,"y2");E=h.getAttributeNS(null,"stroke-width");if(v!==e&&m!==e&&g!==e&&y!==e){b=v/2+m/2;w=g/2+y/2;a=n.posY;u=n.posX;f=a+":"+u;o=l.getComputedTextLength();if(v-m!==0){}d=-o/2;if(a==="bottom"){p=12+t.labelOffset*r[f]+E/2}else if(a==="top"){p=-5-t.labelOffset*r[f]-E/2}else{p=0}l.setAttributeNS(null,"x",b+d);l.setAttributeNS(null,"y",w+p);i=l.getAttributeNS(null,"x");s=l.getAttributeNS(null,"y");c.setAttributeNS(null,"x",i-2);c.setAttributeNS(null,"y",s-10);c.setAttributeNS(null,"width",o+4);r[f]++}};this.setLabelPosBus=function(t,n,r){var i,s,o;var u,a,f;var l,c,h;var p=0,d=0;var v=0,m=0,g=0,y=0,b,w;var E;h=t.svg;l=n.svg;c=n.labelRect;v=h.getAttributeNS(null,"x1");m=h.getAttributeNS(null,"x2");g=h.getAttributeNS(null,"y1");y=h.getAttributeNS(null,"y2");E=h.getAttributeNS(null,"stroke-width");if(v!==e&&m!==e&&g!==e&&y!==e){b=v/2+m/2+t.dx;w=g/2+y/2;a=n.posY;u=n.posX;f=a+":"+u;o=l.getComputedTextLength();if(v-m!==0){}d=-o/2;if(a==="bottom"){w=Math.max(g,y)-t.dy;p=12+t.labelOffset*r[f]+E/2}else if(a==="top"){w=Math.min(g,y)-t.dy;p=-5-t.labelOffset*r[f]-E/2}else{p=0}l.setAttributeNS(null,"x",b+d);l.setAttributeNS(null,"y",w+p);i=l.getAttributeNS(null,"x");s=l.getAttributeNS(null,"y");c.setAttributeNS(null,"x",i-2);c.setAttributeNS(null,"y",s-10);c.setAttributeNS(null,"width",o+4);r[f]++}};this.setNodeStyleByName=function(t,n){node=this.nodeList[t];if(node!==e){if(tNetwork.styles.node[n]!==e){node.style=tNetwork.styles.node[n]}}};this.setLinkStyleByName=function(t,n){var r;r=this.linkList[t];if(r!==e){r.svg.setAttributeNS(null,"class",n)}};this.setLinkStyleByNameTheOther=function(t,n,r){var i,s;i=this.linkList[t];if(i!==e){s=i.svg.getAttributeNS(null,"class");if(s===n){i.svg.setAttributeNS(null,"class",r)}if(s===r){i.svg.setAttributeNS(null,"class",n)}}};this.setLinkEventHandler=function(e,t){this.defaultLinkHandlers[e]=t};this.setDefaultNodeEventHandler=function(e,t){this.defaultNodeHandlers[e]=t};this.addEventHandlerElement=function(e,t,n){if(e.svg!==null){e.svg.addEventListener(t,n,false)}};this.removeEventHandlerNode=function(t,n,r){if(t!==e&&t.svg!==e){if(t===e||n===e||r===e)console.log(t);t.svg.removeEventListener(n,r,false)}};this.addArrowToDefs=function(e,t){var n,r,i;n=document.createElementNS(this.svgNS,"marker");n.setAttributeNS(null,"id",t);for(i in e.marker){n.setAttributeNS(null,i,e.marker[i])}r=document.createElementNS(this.svgNS,e.type);for(i in e.params){r.setAttributeNS(null,i,e.params[i])}n.appendChild(r);document.getElementById(this.defs_id).appendChild(n)};this.getList=function(e){return this.elements[e]["list"]};this.getType=function(e){return e.elementType};this.setElementPropertyById=function(t,n,r){var i,s;i=nodeList[t];if(i!=e){s=i.svg;if(s!=e){s.setAttributeNS(null,n,r)}}};this.setElementProperty=function(t,n,r){var i=t.svg;if(i!=e){i.setAttributeNS(null,n,r)}};this.selectSVGUp=function(e){if(o.selectedElement!==0){o.deselectElementUp(e)}o.movingWorld=0};this.movingWorld=0;this.movingWorldX=0;this.movingWorldY=0;this.currentMatrixWorld=[];this.selectSVGDown=function(t){var n;t.preventDefault();if(o.selectedElement===0){o.movingWorld=true;o.movingWorldX=t.x;o.movingWorldY=t.y}if($("#"+o.svg_id+" g").attr("transform")===e){for(n=0;n<6;n++){o.currentMatrixWorld[n]=0}o.currentMatrixWorld[0]=1;o.currentMatrixWorld[3]=1}else{o.currentMatrixWorld=$("#"+o.svg_id+" g").attr("transform").slice(7,-1).split(" ");for(var n=0;n<o.currentMatrixWorld.length;n++){o.currentMatrixWorld[n]=parseFloat(o.currentMatrixWorld[n])}}};this.selectSVGOut=function(e){o.movingWorld=0};this.selectSVGMove=function(e){var t,n,r;if(o.selectedElement!==0&&o.eventProcessed===0){o.moveElement(e)}else if(o.movingWorld===true){t=e.clientX-o.movingWorldX;n=e.clientY-o.movingWorldY;t=t;n=n;o.currentMatrixWorld[4]+=t;o.currentMatrixWorld[5]+=n;o.movingWorldX=e.x;o.movingWorldY=e.y;r="matrix("+o.currentMatrixWorld.join(" ")+")";$("#"+o.svg_id+" g").attr("transform",r);$("#"+"backgroundImg").attr("transform",r)}o.eventProcessed=0};this.myMultiMatrix=function(e,t){var n,r,i,s=[];for(n=0;n<9;n++){s[n]=0}for(n=0;n<3;n++){for(r=0;r<3;r++){for(i=0;i<3;i++){s[n*3+r]+=e[n*3+i]*t[i*3+r]}}}return s};this.scrolling=function(t){var n,r,i=1,s,u,a,f,l,c;l=[];if(t.altKey){if(t.wheelDelta>0){s=+4}else{s=-4}for(f in this.nodeList){r=this.nodeList[f];if(r.style.type==="image"){if(r.style.params.height+s<5&&l[r.style.id]===e){t.preventDefault();return}if(l[r.style.id]===e){r.style.params.height=r.style.params.height+s;r.style.params.width=r.style.params.width+s;l[r.style.id]=1}}else{throw"Only image type is supported"}if(this.nodeList.hasOwnProperty(f)){n=document.getElementById(r.node_id);n.setAttribute("height",r.style.params.height);n.setAttribute("width",r.style.params.width)}u=parseInt(r.svg.getAttributeNS(null,"x"));a=parseInt(r.svg.getAttributeNS(null,"y"));r.svg.setAttributeNS(null,"x",u-s/2);r.svg.setAttributeNS(null,"y",a-s/2)}}else{var h=[],p=[],d=[],v,m,g=[],y=[],b=[];var w,E=[],S;if(t.wheelDelta>0){this.zoom=this.zoom*1.05;m=1.05}else{this.zoom=this.zoom/1.05;m=1/1.05}c=$("#"+o.svg_id+" g").attr("transform");if(c===e){E[0]=1;E[1]=0;E[2]=0;E[3]=0;E[4]=1;E[5]=0;E[6]=0;E[7]=0;E[8]=1}else{w=c.slice(7,-1).split(" ");E[0]=parseFloat(w[0]);E[1]=parseFloat(w[2]);E[2]=parseFloat(w[4]);E[3]=parseFloat(w[1]);E[4]=parseFloat(w[3]);E[5]=parseFloat(w[5]);E[6]=0;E[7]=0;E[8]=1}for(v=0;v<8;v++){h[v]=0;p[v]=0;d[v]=0}h[0]=1;h[4]=1;h[8]=1;h[2]=-t.x;h[5]=-t.y;p[0]=1;p[4]=1;p[8]=1;p[2]=t.x;p[5]=t.y;d[8]=1;d[0]=m;d[4]=m;g=o.myMultiMatrix(p,d);y=o.myMultiMatrix(h,E);b=o.myMultiMatrix(g,y);S="matrix("+b[0]+" "+b[3]+" "+b[1]+" "+b[4]+" "+b[2]+" "+b[5]+")";$("#"+o.svg_id+" g").attr("transform",S)}o.reDrawLinks(o.linkList);console.log("Wheeling!");t.preventDefault()};this.reDrawLinks=function(e){var t,n,r,i,s;for(s in e){t=e[s].svg;n=e[s];r={};i={};tNetwork.crossingOutPoint(n.src.style,n.src.x,n.src.y,n.dst.x,n.dst.y,n.style.offset,r);tNetwork.crossingOutPoint(n.dst.style,n.dst.x,n.dst.y,n.src.x,n.src.y,-1*n.style.offset,i);t.setAttributeNS(null,"x1",n.src.x+r.x);t.setAttributeNS(null,"y1",n.src.y+r.y);t.setAttributeNS(null,"x2",n.dst.x+i.x);t.setAttributeNS(null,"y2",n.dst.y+i.y);t.setAttributeNS(null,"id",n.src.id+":"+n.dst.id);this.setLabelsPos(n)}};this.reDrawBuses=function(e){var t,n,r;var i={top:0,bottom:0};for(n in e)if(e[n].show===true){this.setBusPosition(e[n]);this.setLabelsPos(e[n])}};this.setBusPosition=function(e){var t,n;var r,i;var s;n=e.svg;s={top:0,bottom:0};this.calculateBusPosition(e,s);n.setAttributeNS(null,"y1",s.bottom+e.dy);n.setAttributeNS(null,"y2",s.top+e.dy)};this.calculateBusPosition=function(t,n){var r,i,s,u;var a=1e5;var f=-1e5;for(r in o.busLinkList)if(o.busLinkList[r].show===true){i=o.busLinkList[r];if(i.bus.style.id!==e&&i.bus.style.id===t.style.id){s=i.svg;u=s.getAttributeNS(null,"y1");a=Math.min(a,u);f=Math.max(f,u)}}if(a!=1e5)n.bottom=a;if(f!=-1e5){if(f-a<t.style.min_height)n.top=a+t.style.min_height;else n.top=f}};this.reDrawBusLinks=function(e){var t,n,r,i,s,u;for(i in e)if(e[i].show===true){t=e[i].svg;n=e[i];s=o.busList[n.bus.style.id];u=s.svg;r={};tNetwork.crossingOutPoint(n.node.style,n.node.x,n.node.y,n.bus.x,n.node.y,0,r);t.setAttributeNS(null,"x1",n.node.x+r.x);t.setAttributeNS(null,"y1",n.node.y+r.y);t.setAttributeNS(null,"x2",n.bus.x);t.setAttributeNS(null,"y2",n.node.y+r.y);t.setAttributeNS(null,"id",n.id);this.setLabelsPos(n)}};this.changeElementVisibility=function(t,n,r,i){var s,o="",u="";var a="";if(i===e){if(r===e){for(o in this.elements){s=this.getList(o);if(s[n]!==e){u=s[n];s[n].show=t}}}else{s=this.getList(r);if(s[n]!==e){u=s[n];s[n].show=t}}}else{u=i;i.show=t}if(u!==""){if(u.elementType==="node"){s=this.getList("link");for(a in s){if(s[a].src.id===u.id||s[a].dst.id===u.id){s[a].show=t}}s=this.getList("buslink");for(a in s){if(s[a].node.id===u.id){s[a].show=t}}}if(u.elementType==="bus"){s=this.getList("buslink");for(a in s){if(s[a].bus.id===u.id){s[a].show=t}}}}};this.moveElement=function(e){var t,n,r,i,s,u,a,f,l=0,c,h;var p,d=0;if(o.selectedElement===0){console.log("Trying to access unselected element");return}t=e.clientX-o.currentX;n=e.clientY-o.currentY;t=t/o.zoom;n=n/o.zoom;o.currentMatrix[4]+=t;o.currentMatrix[5]+=n;r="matrix("+o.currentMatrix.join(" ")+")";o.selectedElement.setAttributeNS(null,"transform",r);o.currentX=e.clientX;o.currentY=e.clientY;o.eventProcessed=1;for(h in o.nodeList){if(h===o.selectedElement.id){l=o.nodeList[h]}}for(p in o.busList){if(p===o.selectedElement.id){d=o.busList[p]}}if(d!==0){d.x+=t;d.dy-=n;d.dx+=t}else if(l!==0){l.x+=t;l.y+=n;this.setHighlightPos(l);this.setLabelsPos(l)}o.reDrawLinks(o.selectedLinkList);o.reDrawBusLinks(o.selectedBusLinkList);o.reDrawBuses(o.selectedBusList)};this.toggleHighlight=function(t,n,r){var i=this.elements[t]["list"];var s=i[n];if(s!=e){if(t==="bus"){this.toggleHighlightBus(n,r)}else if(t==="link"){this.toggleHighlightLine(s.src.id,s.dst.id,r)}else if(t==="buslink"){this.toggleHighlightLine(s.bus.id,s.node.id,r)}else if(t==="node"&&s.highlight!==e){if(r!==e)s.highlight.show=r;else s.highlight.show=!s.highlight.show}}};this.setHighlightPos=function(t){var n=t.svg,r;var i;if(n!==e){if(t.highlight!==e&&t.highlight.svg!==e&&t.highlight.show){r=t.highlight.svg;i=n.getAttributeNS(null,"transform");r.setAttributeNS(null,"transform",i)}}};this.selectElement=function(t){var n,r,i;o.selectedLinkList=[];o.mouseDown++;o.selectedElement=t.target;o.currentX=t.clientX;o.currentY=t.clientY;o.currentMatrix=o.selectedElement.getAttributeNS(null,"transform").slice(7,-1).split(" ");for(var s=0;s<o.currentMatrix.length;s++){o.currentMatrix[s]=parseFloat(o.currentMatrix[s])}if(o.busList[t.target.id]!==e){for(r in o.busLinkList){if(o.busLinkList.hasOwnProperty(r)&&o.busLinkList[r].bus.style.id===t.target.id){o.selectedBusLinkList[r]=o.busLinkList[r]}}o.selectedBusList[t.target.id]=o.busList[t.target.id]}for(r in o.busLinkList){if(o.busLinkList.hasOwnProperty(r)&&o.busLinkList[r].node.id===t.target.id){o.selectedBusLinkList[r]=o.busLinkList[r];i=o.busLinkList[r].bus.style.id;o.selectedBusList[i]=o.busList[i]}}for(n in o.linkList){if(o.linkList.hasOwnProperty(n)&&o.linkList[n].src.id===t.target.id||o.linkList[n].dst.id===t.target.id){o.selectedLinkList[n]=o.linkList[n]}}};this.deselectElementUp=function(e){o.mouseDown--;if(o.selectedElement!==0){o.selectedElement.removeAttributeNS(null,"onmousemove");o.selectedElement.removeAttributeNS(null,"onmouseout");o.selectedElement.removeAttributeNS(null,"onmouseup");o.selectedElement=0}};this.deselectElementOut=function(e){if(o.mouseDown){}else if(o.selectedElement!=0){o.selectedElement.removeAttributeNS(null,"onmousemove");o.selectedElement.removeAttributeNS(null,"onmouseout");o.selectedElement.removeAttributeNS(null,"onmouseup");o.selectedElement=0}};this.elements={layer:{list:this.layerList,draw:this.drawLayer},buslink:{list:this.busLinkList,draw:this.drawBusLink,setlabel:this.setLabelPosLink,labelposx:"center",labelposy:"top"},bus:{list:this.busList,draw:this.drawBus,setlabel:this.setLabelPosBus,labelposx:"center",labelposy:"top"},link:{list:this.linkList,draw:this.drawLink,setlabel:this.setLabelPosLink,labelposx:"center",labelposy:"top"},node:{list:this.nodeList,draw:this.drawNode,setlabel:this.setLabelPosNode,labelposx:"center",labelposy:"bottom"}}};tNetwork.Network.prototype={svgNS:"http://www.w3.org/2000/svg",xlinkNS:"http://www.w3.org/1999/xlink",defaultNodeClass:"roadm",defaultLinkClass:"fiberLink",defaultLinkHandlers:[],defaultNodeHandlers:[],net:e,editMode:false};tNetwork.crossingOutPoint=function(t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g;var y,b,w,E,S,x,T,N,C,k,L,A,O,M;d=i-n;v=s-r;c=v/d;if(t.anchPoint!=e){}else if(t.type==="image"){if(o>t.params.height/2||o>t.params.width/2){console.log("Offset is too big and the edge will be outside of the image")}else{y=i-n;b=s-r;S=b;x=-y;T=Math.sqrt(S*S+x*x);S=S/T;x=x/T;w=n+S*o;E=r+x*o;k=Math.atan((E-(r-t.params.height/2))/(n+t.params.width/2-w));L=Math.PI-Math.atan((E-(r-t.params.height/2))/(w-(n-t.params.width/2)));A=Math.PI+Math.atan((r+t.params.height/2-E)/(w-(n-t.params.width/2)));O=2*Math.PI-Math.atan((r+t.params.height/2-E)/(n+t.params.width/2-w));M=Math.acos(y/Math.sqrt(y*y+b*b));if(b>0){M=2*Math.PI-M}if(M<=k||M>=O){N=(n+t.params.width/2-w)/y;C=E+N*b-r;u.x=t.params.width/2;u.y=C}else if(k<M&&M<=L){N=(r-t.params.height/2-E)/b;C=w+N*y-n;u.x=C;u.y=-t.params.height/2}else if(L<M&&M<=A){N=(n-t.params.width/2-w)/y;C=E+N*b-r;u.x=-t.params.width/2;u.y=C}else if(A<M&&M<O){N=(r+t.params.height/2-E)/b;C=w+N*y-n;u.x=C;u.y=t.params.height/2}}}else if(t.type==="circle"){if(c===Infinity){u.x=o;u.y=Math.sqrt(t.params.r*t.params.r-o*o)}else if(c===-Infinity){u.x=-1*o;u.y=-1*Math.sqrt(t.params.r*t.params.r-o*o)}else if(c==0){u.y=-1*tNetwork.sign(d)*o;u.x=tNetwork.sign(d)*Math.sqrt(t.params.r*t.params.r-o*o)}else{h=Math.cos(Math.atan(c));if(tNetwork.sign(d)===1){if(tNetwork.sign(h)!=1){h=-1*h}}else{if(tNetwork.sign(h)!=-1){h=-1*h}}p=Math.sin(Math.atan(c));if(tNetwork.sign(v)===1){if(tNetwork.sign(p)!=1){p=-1*p}}else{if(tNetwork.sign(p)!=-1){p=-1*p}}a=1+c*c;f=2*o/h;l=o*o/(h*h)-c*c*t.params.r*t.params.r;m=(-f+Math.sqrt(f*f-4*a*l))/(2*a);g=(-f-Math.sqrt(f*f-4*a*l))/(2*a);if(tNetwork.sign(p)===1){if(m>g){u.y=m}else{u.y=g}}else{if(m<g){u.y=m}else{u.y=g}}u.x=(u.y+o/h)/c}}};tNetwork.sign=function(e){return e>0?1:e<0?-1:0};tNetwork.setSVGAttributes=function(e,t){var n;for(n in t){e.setAttributeNS(null,n,t[n])}};tNetwork.NetworkLink.prototype={bidirectional:false};tNetwork.NetworkNode.prototype={showLabel:true};tNetwork.styles={};tNetwork.styles.matrix={transform:"matrix(1 0 0 1 0 0)"};tNetwork.styles.node={defaultNode:{id:"defaultNode",type:"circle",params:{"class":"defaultNode",r:30,transform:"matrix(1 0 0 1 0 0)"},xLabelOffset:-50,yLabelOffset:50},defaultCircle:{id:"defaultCircle",type:"circle",params:{"class":"defaultNode",r:30,"fill-opacity":.1,fill:"blue",stroke:"blue","stroke-width":2,transform:"matrix(1 0 0 1 0 0)"},xLabelOffset:-50,yLabelOffset:50},defaultHighlight:{id:"defaultHighlight",type:"circle",params:{"class":"defaultNode",r:30,"fill-opacity":1,fill:"#E6E6FF",stroke:"#0061b0","stroke-width":2,transform:"matrix(1 0 0 1 0 0)"},xLabelOffset:-50,yLabelOffset:50},defaultHighlightCircle:{id:"defaultHighlight",type:"circle",params:{"class":"defaultNode",r:35,"fill-opacity":1,fill:"#E6E6FF",stroke:"#0061b0","stroke-width":2,transform:"matrix(1 0 0 1 0 0)"},xLabelOffset:-50,yLabelOffset:50},defaultNode2:{id:"defaultNode2",type:"img",params:{"class":"circleNode",href:"../img/router.png",height:70,width:70,transform:"matrix(1 0 0 1 0 0)"},xLabelOffset:-50,yLabelOffset:50}};tNetwork.styles.link={defaultUnidirectionalLink:{type:"line",params:{"class":"defaultUnidirectionalLink","marker-end":"url(#upperHalfArrow)","stroke-width":2,cursor:"pointer"},offset:2},defaultBidirectionalLink:{type:"line",params:{"class":"defaultUnidirectionalLink","stroke-width":2,cursor:"pointer"},offset:0}};tNetwork.styles.arrow={triangleArrow:{marker:{viewBox:"0 0 30 30",refX:"27",refY:"15",orient:"auto",markerHeight:"30",markerWidth:"5",markerUnits:"strokeWidth",id:"triangleArrow"},type:"path",params:{d:"M 0 0 L 15 15 L 0 15 z",stroke:"black",fill:"black"}},upperHalfArrow:{marker:{viewBox:"0 0 15 7",refX:"15",refY:"7",orient:"auto",markerHeight:"30",markerWidth:"5",markerUnits:"strokeWidth",id:"upperHalfArrow"},type:"path",params:{d:"M 0 0 L 15 7 L 0 7 z",stroke:"black",fill:"black",id:"upperHalfArrowPath"}}};tNetwork.styles.labelRect={type:"rect",xoffset:"3",yoffset:"3",params:{rx:"3",ry:"3",transform:"matrix(1 0 0 1 0 0)",height:"13",fill:"white",stroke:"black","stroke-width":"1",opacity:"0.7"}};tNetwork.styles.bus={defaultBus:{type:"line",params:{"class":"def",transform:"matrix(1 0 0 1 0 0)","stroke-width":"7","stroke-linecap":"round",stroke:"#000000"}},bus1:{type:"line",params:{transform:"matrix(1 0 0 1 0 0)","stroke-width":"7","stroke-linecap":"round",stroke:"orange"}},bus2:{type:"line",params:{transform:"matrix(1 0 0 1 0 0)","stroke-width":"7","stroke-linecap":"round",stroke:"green"}},bus3:{type:"line",params:{transform:"matrix(1 0 0 1 0 0)","stroke-width":"7","stroke-linecap":"round",stroke:"#0029A3"}},bus4:{type:"line",params:{transform:"matrix(1 0 0 1 0 0)","stroke-width":"7","stroke-linecap":"round",stroke:"#660000"}},"bus2:bus1":{type:"line",params:{transform:"matrix(1 0 0 1 0 0)","stroke-width":"6","stroke-linecap":"round",stroke:"#6600CC"}},"bus1:bus2":{type:"line",params:{transform:"matrix(1 0 0 1 0 0)","stroke-width":"6","stroke-linecap":"round",stroke:"#6600CC"}}};tNetwork.Defaults={}})()